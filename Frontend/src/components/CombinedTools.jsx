import React, { useState } from "react";
import toolsinfo from "../utils/toolsInfo.json";
import axios from "axios";

// Utility function to generate the initial state
const generateInitialState = (toolsinfo) => {
  const initialState = {};
  Object.keys(toolsinfo).forEach((category) => {
    toolsinfo[category].forEach((tool) => {
      initialState[tool.name] = false;
    });
  });
  return initialState;
};

const CombinedTools = () => {
  const initialState = generateInitialState(toolsinfo);

  const [selectedTools, setSelectedTools] = useState(initialState);

  const handleCheckboxChange = (event) => {
    const { id, checked } = event.target;
    setSelectedTools((prevState) => ({
      ...prevState,
      [id]: checked,
    }));
  };

  const runJDGUI = async () => {
    const res = await axios.post("http://localhost:4002/jd-gui/run")
    console.log(res.data)
  }

  const runBurpSuite = async () => {
    const res = await axios.post("http://localhost:4002/run-tool",{
      tool: "BurpSuite"
    })
  }

  const handleClick = () => {
    const selected = Object.keys(selectedTools).filter((key) => selectedTools[key]);
    console.log("Selected tools:", selected);
    selected.map((tool) => {
      if(tool=="JD-GUI"){
        runJDGUI()
      }
      if(tool=="BurpSuite"){
        runBurpSuite()
      }
    })
  };

  return (
    <>
      <div
        className="apk2"
        style={{
          padding: "20px",
          margin: "auto",
          display: "flex",
          flexDirection: "row",
          justifyContent: "center",
          alignItems: "center",
          flexWrap: "wrap",
        }}
      >
        <div className="file-input-container">
          <label
            htmlFor="file-input"
            className="custom-file-upload"
            style={{ marginTop: "10px" }}
          >
            Choose File
          </label>
          <br />
          <input
            type="file"
            accept=".apk"
            id="file-input"
            className="custom-file-input"
            style={{
              border: "1px solid black",
              padding: "10px",
              height: "48px",
              backgroundColor : "white",
            }}
          />
        </div>
        <div className="ip-input-container">
          <label
            htmlFor="ip-input"
            className="custom-ip-upload"
            style={{
              marginLeft: "20px",
              marginTop: "10px",
            }}
          >
            Type IP Address
          </label>
          <br />
          <input
            type="text"
            placeholder="0.0.0.0"
            style={{
              border: "1px solid black",
              padding: "10px",
              marginLeft: "20px",
              height: "48px",
            }}
          />
        </div>
      </div>
      <div className="container">
        {Object.keys(toolsinfo).map((category, categoryIndex) => (
          <div key={categoryIndex} className="card bg-light mb-3">
            <div className="card-body">
              <h5>{category}</h5>
              <div style={{ display: "flex", flexWrap: "wrap" }}>
                {toolsinfo[category].map((tool, toolIndex) => (
                  <div key={toolIndex} className="card-body-tool">
                    <input
                      type="checkbox"
                      id={tool.name}
                      onChange={handleCheckboxChange}
                    />
                    <label htmlFor={tool.name} style={{ marginRight: "20px" , padding:"5px"}}>
                      {tool.name}
                    </label>
                  </div>
                ))}
              </div>
            </div>
          </div>
        ))}
        <div>
          <button
            type="button"
            className="btn btn-primary"
            onClick={handleClick}
            style={{ marginBottom: "20px" }}
          >
            Run
          </button>
        </div>
      </div>
    </>
  );
};

export default CombinedTools;




