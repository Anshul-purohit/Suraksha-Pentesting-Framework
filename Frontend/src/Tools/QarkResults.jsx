import React, { useState } from 'react';

const QarkResults = ({ results = [] }) => { // Default to empty array
    console.log("Inside QarkResults");
    console.log("Results: ", results);

    if (!results || !Array.isArray(results) || results.length === 0) {
        console.log("empty results");
        return <p>No results available</p>;
    }

    const severityColors = {
        'INFO': '#28a745',
        'WARNING': '#ffc107',
        'VULNERABILITY': '#dc3545'
    };

    // Parse results into sections
    const sections = {
        'INFO': [],
        'WARNING': [],
        'VULNERABILITY': []
    };

    results.forEach(result => {
        const { severity, description, file_object } = result;
        if (sections[severity]) {
            sections[severity].push({ description, file_object });
        }
    });

    const [openSection, setOpenSection] = useState(null);

    const toggleAccordion = (severity) => {
        setOpenSection(openSection === severity ? null : severity);
    };

    return (
        <div style={{ fontFamily: 'Arial, sans-serif', maxWidth: '800px', margin: '0 auto', padding: '20px' }}>
            <h2 style={{ textAlign: 'center', color: '#333', marginBottom: '30px' }}>Qark Analysis Results</h2>
            {Object.entries(sections).map(([severity, items], index) => (
                <div key={index} style={{ marginBottom: '20px' }}>
                    <div 
                        style={{ 
                            padding: '10px', 
                            backgroundColor: severityColors[severity],
                            color: 'white',
                            cursor: 'pointer',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center'
                        }}
                        onClick={() => toggleAccordion(severity)}
                    >
                        <h3 style={{ margin: 0 }}>{severity}</h3>
                        <span>{openSection === severity ? '▲' : '▼'}</span>
                    </div>
                    {openSection === severity && (
                        <ul style={{ listStyleType: 'none', padding: '10px', margin: 0, backgroundColor: '#f9f9f9' }}>
                            {items.map((item, itemIndex) => (
                                <li key={itemIndex} style={{ marginBottom: '5px', lineHeight: '1.5' }}>
                                    <strong>Description:</strong> {item.description}
                                    <br />
                                    <strong>File:</strong> {item.file_object}
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            ))}
        </div>
    );
};

export default QarkResults;
